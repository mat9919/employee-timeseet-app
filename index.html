<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>จัดการเงิน</title>
        
    <!-- Library & Fonts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;600;700&display=swap" rel="stylesheet">
        
    <!-- === CSS Styles === -->
    <style>
        :root {
            --bg-dark: #121212;
            --surface-dark: #1e1e1e;
            --border-color: #3a3a3a;
            --primary-text: #e0e0e0;
            --secondary-text: #8a91a0;
            --income-color: #22c55e; /* Green */
            --expense-color: #ef4444; /* Red */
            --accent-blue: #3b82f6;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--bg-dark);
            color: var(--primary-text);
            overscroll-behavior: none;
            padding-bottom: 80px; /* กันพื้นที่ให้ footer */
        }
        .app-header {
            background-color: var(--surface-dark);
            text-align: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            position: sticky; top: 0; z-index: 10;
        }
        .app-header h1 { font-size: 1.2rem; font-weight: 500; }
        .container { padding: 1rem; }
        .period-selector {
            display: flex; justify-content: space-between; align-items: center;
            background-color: var(--surface-dark); padding: 0.75rem 1rem;
            border-radius: 12px; margin-bottom: 1.5rem;
        }
        .period-selector h2 { font-size: 1.1rem; font-weight: 600; }
        .period-selector button { background: none; border: none; color: var(--primary-text); font-size: 1.2rem; cursor: pointer; }
        .action-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem; }
        .btn {
            display: flex; align-items: center; justify-content: center; gap: 0.5rem;
            width: 100%; padding: 1rem; border: none; border-radius: 12px;
            font-family: 'Kanit', sans-serif; font-size: 1rem; font-weight: 500;
            cursor: pointer; transition: transform 0.2s;
        }
        .btn:active { transform: scale(0.95); }
        .btn-income { background-color: var(--income-color); color: white; }
        .btn-expense { background-color: var(--expense-color); color: white; }
        .transaction-list h3 { font-weight: 500; color: var(--secondary-text); margin-bottom: 1rem; }
        .transaction-list ul { list-style: none; }
        .transaction-list li {
            display: flex; align-items: center; background-color: var(--surface-dark);
            padding: 1rem; border-radius: 12px; margin-bottom: 0.75rem;
        }
        .transaction-list .no-data { justify-content: center; color: var(--secondary-text); }
        .t-icon {
            width: 45px; height: 45px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            margin-right: 1rem; flex-shrink: 0;
        }
        .t-icon i { font-size: 1.2rem; }
        .t-icon img { width: 28px; height: 28px; object-fit: contain; }
        .t-details { flex-grow: 1; display: flex; flex-direction: column; }
        .t-title { font-weight: 500; }
        .t-date { font-size: 0.8rem; color: var(--secondary-text); }
        .t-amount { font-weight: 600; font-size: 1.1rem; }
        .income { color: var(--income-color); }
        .expense { color: var(--expense-color); }
        .summary-footer {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background-color: var(--surface-dark); display: grid;
            grid-template-columns: 1fr 1fr 1.5fr; padding: 0.75rem 1rem;
            border-top: 1px solid var(--border-color); z-index: 10;
        }
        .summary-item { display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .summary-item .label { font-size: 0.8rem; color: var(--secondary-text); margin-bottom: 0.25rem; }
        .summary-item .amount { font-weight: 600; }
        .summary-item.net .amount { font-size: 1.5rem; font-weight: 700; color: white; }
    </style>
</head>
<body>

    <header class="app-header">
        <h1>การเงินส่วนบุคคล</h1>
    </header>

    <main class="container">
        <section class="period-selector">
            <button id="prev-month"><i class="fas fa-chevron-left"></i></button>
            <h2 id="month-display"></h2>
            <button id="next-month"><i class="fas fa-chevron-right"></i></button>
        </section>

        <section class="action-buttons">
            <button id="add-income-btn" class="btn btn-income"><i class="fas fa-plus"></i> เพิ่มรายรับ</button>
            <button id="add-expense-btn" class="btn btn-expense"><i class="fas fa-minus"></i> เพิ่มรายจ่าย</button>
        </section>

        <section class="transaction-list">
            <h3>รายการล่าสุด</h3>
            <ul id="transactions">
                <!-- รายการจะถูกสร้างโดย JavaScript -->
            </ul>
        </section>
    </main>

    <footer class="summary-footer">
        <div class="summary-item">
            <span class="label">รายรับ</span>
            <span id="total-income" class="amount income">+0.00</span>
        </div>
        <div class="summary-item">
            <span class="label">รายจ่าย</span>
            <span id="total-expense" class="amount expense">-0.00</span>
        </div>
        <div class="summary-item net">
            <span class="label">คงเหลือ</span>
            <span id="net-balance" class="amount">0.00</span>
        </div>
    </footer>

    <!-- === JavaScript Logic === -->
    <script>
        // --- ส่วนที่ 1: การตั้งค่าและเชื่อมต่อ SUPABASE ---
        const SUPABASE_URL = 'https://fipsalpfzrqnashdimqi.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZpcHNhbHBmenJxbmFzaGRpbXFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwODQ0MjQsImV4cCI6MjA3MjY2MDQyNH0.lhs3PlCdz5kmO8xm7F_w93eT-0v2Sp-BZRxbLyAWCDc';
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // --- ส่วนที่ 2: รอให้หน้าเว็บโหลดเสร็จก่อนเริ่มทำงาน ---
        document.addEventListener('DOMContentLoaded', () => {
                
            let state = {
                currentDate: new Date(),
                transactions: [],
                categories: []
            };

            const monthDisplay = document.getElementById('month-display');
            const transactionList = document.getElementById('transactions');
            const totalIncomeEl = document.getElementById('total-income');
            const totalExpenseEl = document.getElementById('total-expense');
            const netBalanceEl = document.getElementById('net-balance');

            async function initializeApp() {
                // ในอนาคต เราจะดึงข้อมูลหมวดหมู่จาก Supabase ที่นี่
                await fetchDataForCurrentMonth();
            }

            async function fetchDataForCurrentMonth() {
                // ตอนนี้จะใช้ข้อมูลตัวอย่างไปก่อน
                state.transactions = [
                    { id: 1, description: 'เงินเดือน', amount: 30000, type: 'income', transaction_date: '2025-09-01', icon: 'fa-briefcase', color: '#22c55e' },
                    { id: 2, description: 'จ่ายบัตร KBank Shopee', amount: 5400, type: 'expense', transaction_date: '2025-08-31', logo: 'https://i.imgur.com/2V3S16q.png', color: '#ef4444' }
                ];
                renderUI();
            }

            function renderUI() {
                monthDisplay.textContent = state.currentDate.toLocaleDateString('th-TH', { month: 'long', year: 'numeric' });
                transactionList.innerHTML = '';
                if (state.transactions.length === 0) {
                    transactionList.innerHTML = '<li class="no-data">ยังไม่มีรายการในเดือนนี้</li>';
                } else {
                    state.transactions.forEach(tx => {
                        const item = document.createElement('li');
                        const amountSign = tx.type === 'income' ? '+' : '-';
                        const amountClass = tx.type === 'income' ? 'income' : 'expense';
                        let iconHtml = tx.logo 
                            ? `<img src="${tx.logo}" alt="${tx.description}">`
                            : `<i class="fas ${tx.icon}" style="color: ${tx.color};"></i>`;

                        item.innerHTML = `
                            <div class="t-icon" style="background-color: ${tx.color}20;">${iconHtml}</div>
                            <div class="t-details">
                                <span class="t-title">${tx.description}</span>
                                <span class="t-date">${new Date(tx.transaction_date).toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: 'numeric' })}</span>
                            </div>
                            <span class="t-amount ${amountClass}">${amountSign}${tx.amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
                        `;
                        transactionList.appendChild(item);
                    });
                }

                const totalIncome = state.transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
                const totalExpense = state.transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
                const netBalance = totalIncome - totalExpense;

                totalIncomeEl.textContent = `+${totalIncome.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
                totalExpenseEl.textContent = `-${totalExpense.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
                netBalanceEl.textContent = netBalance.toLocaleString('en-US', { minimumFractionDigits: 2 });
            }

            document.getElementById('prev-month').addEventListener('click', () => {
                state.currentDate.setMonth(state.currentDate.getMonth() - 1);
                fetchDataForCurrentMonth();
            });

            document.getElementById('next-month').addEventListener('click', () => {
                state.currentDate.setMonth(state.currentDate.getMonth() + 1);
                fetchDataForCurrentMonth();
            });
                
            document.getElementById('add-income-btn').addEventListener('click', () => {
                alert('ฟังก์ชัน "เพิ่มรายรับ" กำลังอยู่ในระหว่างการพัฒนาครับ!');
            });

            document.getElementById('add-expense-btn').addEventListener('click', () => {
                alert('ฟังก์ชัน "เพิ่มรายจ่าย" กำลังอยู่ในระหว่างการพัฒนาครับ!');
            });

            initializeApp();
        });
    </script>
</body>
</html>
